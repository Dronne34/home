#!/bin/bash

# Get the current brightness value
current_brightness=$(xrandr --current --verbose | grep -i brightness | awk '{print $2}')

# Set the base brightness value (change this to your desired base brightness)
base_brightness=1.0

# Set the reduced brightness values
brightness_step1=0.9
brightness_step2=0.8
brightness_step3=0.7
brightness_step4=0.6
brightness_step5=0.5
brightness_step6=0.4
brightness_step7=0.3
brightness_step8=0.2
# Set the touchpad device name (you may need to adjust this based on your system)
touchpad_device="DELL08BD:00 04F3:30CB Touchpad"

# Function to set brightness
set_brightness() {
    xrandr --output $(xrandr | grep " connected" | awk '{print $1}') --brightness $1
}

# Function to restore brightness
restore_brightness() {
    set_brightness $current_brightness
}

# Trap touchpad events and restore brightness
trap 'restore_brightness' INT

# Reduce brightness to 50% in three steps
set_brightness $brightness_step1
sleep 0.3
set_brightness $brightness_step2
sleep 0.3
set_brightness $brightness_step3
sleep 0.3
set_brightness $brightness_step4
sleep 0.3
set_brightness $brightness_step5
sleep 0.3
set_brightness $brightness_step6
sleep 0.3
set_brightness $brightness_step7
sleep 0.3
set_brightness $brightness_step8

# Monitor touchpad events
xinput test "$touchpad_device" | while read EVENT
do
    # If touchpad is touched, restore brightness
    if [[ "EVENT type 4 (ButtonPress)" ]]; then
        restore_brightness
        exit 126
    fi
done
